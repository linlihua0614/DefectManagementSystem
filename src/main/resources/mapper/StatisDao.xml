<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lhlin.dao.StatisDao">
    <select id="getSeriousness" parameterType="com.lhlin.entity.Seriousness" resultType="com.lhlin.entity.Seriousness">
        select
        d.seriousness,
        sum(if(d.state in('open','assigned','fixed','rejectd','deferred','reopen'),1,0)) seriousnessIng,
        sum(if(d.state in('closed'),1,0)) seriousnessEd
        from defect  d
        where d.state <![CDATA[ <> ]]> 'new' and d.projId = #{projId}
        <if test="handler !=null and handler !=''">
            and d.handler = #{handler}
        </if >
        <if test="startTime !=null and startTime !=''">
            and d.createTime >= #{startTime}
        </if >
        <if test="endTime !=null and endTime !=''">
            and d.createTime &lt;= concat(#{endTime},' 23:59:59')
        </if >
        group by d.seriousness
    </select>

    <!-- mybatis会自动将结果集映射为employee的List -->
    <select id="getPriority" parameterType="com.lhlin.entity.Priority" resultType="com.lhlin.entity.Priority">
        select
        d.priority,
        sum(if(d.state in('open','assigned','fixed','rejectd','deferred','reopen'),1,0)) priorityIng,
        sum(if(d.state in('closed'),1,0)) priorityEd
        from defect  d
        where d.state <![CDATA[ <> ]]> 'new' and d.projId = #{projId}
        <if test="handler !=null and handler !=''">
            and d.handler = #{handler}
        </if >
        <if test="startTime !=null and startTime !=''">
            and d.createTime >= #{startTime}
        </if >
        <if test="endTime !=null and endTime !=''">
            and d.createTime &lt;= concat(#{endTime},' 23:59:59')
        </if >
        group by d.priority
    </select>

</mapper>